# Enablement Check
{{- if and .Values.global.secrets.create (eq .Values.global.secrets.auth.provider "entra") }}

# Data Validation
{{- if not .Values.global.secrets.auth.entra.secretName }}
  {{- fail "global.secrets.auth.entra.secretName is required when auth provider is entra and create is true" }}
{{- end }}
{{- if not .Values.global.secrets.auth.entra.values.clientId }}
  {{- fail "global.secrets.auth.entra.values.clientId is required when auth provider is entra and create is true" }}
{{- end }}
{{- if not .Values.global.secrets.auth.entra.values.clientSecret }}
  {{- fail "global.secrets.auth.entra.values.clientSecret is required when auth provider is entra and create is true" }}
{{- end }}
{{- if not .Values.global.secrets.auth.entra.values.tenantId }}
  {{- fail "global.secrets.auth.entra.values.tenantId is required when auth provider is entra and create is true" }}
{{- end }}

# Secret Resource
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.global.secrets.auth.entra.secretName }}
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "governance-platform.labels" . | nindent 4 }}
type: Opaque
stringData:
  {{ .Values.global.secrets.auth.entra.keys.clientId }}: {{ .Values.global.secrets.auth.entra.values.clientId | quote }}
  {{ .Values.global.secrets.auth.entra.keys.clientSecret }}: {{ .Values.global.secrets.auth.entra.values.clientSecret | quote }}
  {{ .Values.global.secrets.auth.entra.keys.tenantId }}: {{ .Values.global.secrets.auth.entra.values.tenantId | quote }}
  {{- if .Values.global.secrets.auth.entra.values.graphClientId }}
  {{ .Values.global.secrets.auth.entra.keys.graphClientId }}: {{ .Values.global.secrets.auth.entra.values.graphClientId | quote }}
  {{- end }}
  {{- if .Values.global.secrets.auth.entra.values.graphClientSecret }}
  {{ .Values.global.secrets.auth.entra.keys.graphClientSecret }}: {{ .Values.global.secrets.auth.entra.values.graphClientSecret | quote }}
  {{- end }}
{{- end }}
