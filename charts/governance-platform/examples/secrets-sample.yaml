# =============================================================================
# GOVERNANCE PLATFORM - SECRETS SAMPLE
# =============================================================================
# This file documents all secrets required by the Governance Platform.
#
# WARNING: This is a TEMPLATE file - do NOT use these values in production
# WARNING: NEVER commit actual secrets to version control
#
# USAGE:
#   1. Copy this file to a secure location outside your repo
#   2. Replace all placeholder values with your actual credentials
#   3. Use with: helm install -f secrets.yaml -f values.yaml ...
#
# NOTE: The database password only needs to be set in global.secrets.database.values.password.
# The Bitnami PostgreSQL chart uses a placeholder password in values.yaml which is
# overridden at runtime by the existingSecret (platform-database).
#
# ALTERNATIVE: Create secrets manually in Kubernetes (recommended for production)
#   See the kubectl commands at the bottom of this file
# =============================================================================

global:
  secrets:
    # Enable automatic secret creation from values below
    # Set to false for production - create secrets manually instead
    create: true

    # =========================================================================
    # DATABASE CREDENTIALS
    # =========================================================================
    # Used by: governance-service, auth-service, integrity-service
    database:
      secretName: "platform-database"
      values:
        username: "postgres"
        password: "REPLACE_WITH_SECURE_PASSWORD" # Generate: openssl rand -hex 32

    # =========================================================================
    # AUTHENTICATION PROVIDER
    # =========================================================================
    # Choose ONE provider: auth0, keycloak, OR entra
    auth:
      provider: "auth0" # Options: auth0, keycloak, entra

      # --- Auth0 Configuration (M2M credentials only) ---
      # Used by: auth-service for backend authentication (when provider=auth0)
      # Note: SPA client ID goes in governance-studio.config (see values files)
      auth0:
        secretName: "platform-auth0"
        values:
          # EQTYLab Platform API M2M credentials (token validation)
          clientId: "REPLACE_WITH_AUTH0_M2M_CLIENT_ID"
          clientSecret: "REPLACE_WITH_AUTH0_M2M_CLIENT_SECRET"
          # Auth Service Backend M2M credentials (Management API)
          mgmtClientId: "REPLACE_WITH_MGMT_CLIENT_ID"
          mgmtClientSecret: "REPLACE_WITH_MGMT_CLIENT_SECRET"

      # --- Keycloak Configuration ---
      # Used by: governance-service, auth-service (when provider=keycloak)
      # Uncomment and configure if using Keycloak instead of Auth0
      # keycloak:
      #   secretName: "platform-keycloak"
      #   values:
      #     serviceAccountClientId: "governance-platform-backend"  # Keycloak client ID created during bootstrap
      #     serviceAccountClientSecret: "REPLACE_WITH_KEYCLOAK_CLIENT_SECRET"  # Keycloak client secret created during bootstrap
      #     tokenExchangePrivateKey: "REPLACE_WITH_TOKEN_EXCHANGE_PRIVATE_KEY"  # Generate: openssl genrsa 2048

      # --- Microsoft Entra ID Configuration ---
      # Used by: auth-service, governance-service, governance-studio (when provider=entra)
      # Uncomment and configure if using Entra ID instead of Auth0/Keycloak
      # entra:
      #   secretName: "platform-entra"
      #   values:
      #     clientId: "REPLACE_WITH_ENTRA_CLIENT_ID"              # Application (client) ID from Azure app registration
      #     clientSecret: "REPLACE_WITH_ENTRA_CLIENT_SECRET"      # Client secret from Azure app registration
      #     tenantId: "REPLACE_WITH_ENTRA_TENANT_ID"              # Directory (tenant) ID from Azure
      #     graphClientId: "REPLACE_WITH_GRAPH_CLIENT_ID"          # App registration client ID with Graph API permissions
      #     graphClientSecret: "REPLACE_WITH_GRAPH_CLIENT_SECRET"  # Client secret for Graph API access

    # =========================================================================
    # STORAGE CREDENTIALS
    # =========================================================================
    # Configure credentials for your chosen storage provider(s)
    # Each service can use a different provider
    storage:
      # --- AWS S3 ---
      # Used by: governance-service, integrity-service (when using aws_s3)
      aws_s3:
        secretName: "platform-aws-s3"
        values:
          accessKeyId: "REPLACE_WITH_AWS_ACCESS_KEY_ID"
          secretAccessKey: "REPLACE_WITH_AWS_SECRET_ACCESS_KEY"

      # --- Azure Blob Storage ---
      # Used by: governance-service, integrity-service (when using azure_blob)
      azure_blob:
        secretName: "platform-azure-blob"
        values:
          accountKey: "REPLACE_WITH_AZURE_STORAGE_KEY"
          connectionString: "DefaultEndpointsProtocol=https;AccountName=yourstorageaccount;AccountKey=REPLACE_WITH_KEY;EndpointSuffix=core.windows.net"

      # --- Google Cloud Storage ---
      # Used by: governance-service, integrity-service (when using gcs)
      gcs:
        secretName: "platform-gcs"
        values:
          serviceAccountJson: |
            {
              "type": "service_account",
              ...
            }

    # =========================================================================
    # SECRET MANAGER (for credential signing)
    # =========================================================================
    # Used by: auth-service for signing
    secretManager:
      provider: "azure_key_vault"

      azure_key_vault:
        enabled: true
        secretName: "platform-azure-key-vault"
        values:
          clientId: "REPLACE_WITH_AZURE_CLIENT_ID"
          clientSecret: "REPLACE_WITH_AZURE_CLIENT_SECRET"
          tenantId: "REPLACE_WITH_AZURE_TENANT_ID"
          vaultUrl: "https://your-vault.vault.azure.net/"

    # =========================================================================
    # PLATFORM ENCRYPTION
    # =========================================================================
    # Used by: governance-service for encrypting credential data in the database
    encryption:
      secretName: "platform-encryption-key"
      values:
        key: "REPLACE_WITH_ENCRYPTION_KEY" # Generate: openssl rand -base64 32

    # =========================================================================
    # GOVERNANCE WORKER CREDENTIALS
    # =========================================================================
    # Used by: auth-service for managing the governance worker's service account
    # Requires an Auth0 M2M application or Keycloak service account
    governanceWorker:
      secretName: "platform-governance-worker"
      values:
        encryptionKey: "REPLACE_WITH_WORKER_ENCRYPTION_KEY" # Generate: openssl rand -base64 32
        clientId: "REPLACE_WITH_M2M_CLIENT_ID"
        clientSecret: "REPLACE_WITH_M2M_CLIENT_SECRET"

    # =========================================================================
    # AUTH SERVICE CREDENTIALS
    # =========================================================================
    # Used by: auth-service for API security
    authService:
      secretName: "platform-auth-service"
      values:
        apiSecret: "REPLACE_WITH_API_SECRET" # Generate: openssl rand -base64 32
        jwtSecret: "REPLACE_WITH_JWT_SECRET" # Generate: openssl rand -base64 32

    # =========================================================================
    # IMAGE REGISTRY CREDENTIALS
    # =========================================================================
    # Used by: All services for pulling container images from GHCR
    imageRegistry:
      secretName: "platform-image-pull-secret"
      registry: "ghcr.io"
      values:
        username: "your-github-username"
        password: "REPLACE_WITH_GITHUB_PAT" # GitHub PAT with read:packages scope
        email: "your-email@example.com"
# =============================================================================
# SECRET CREATION COMMANDS
# =============================================================================
# Run these commands before deploying (or use secrets-sample.yaml instead):
#
# # Create namespace
# kubectl create namespace governance
#
# # Database Credentials
# kubectl create secret generic platform-database \
#   --from-literal=username=postgres \
#   --from-literal=password="$(openssl rand -hex 32)" \
#   --namespace governance
#
# # Auth0 Credentials (if using Auth0)
# kubectl create secret generic platform-auth0 \
#   --from-literal=client-id=YOUR_AUTH0_CLIENT_ID \
#   --from-literal=client-secret=YOUR_AUTH0_CLIENT_SECRET \
#   --from-literal=mgmt-client-id=YOUR_AUTH0_MGMT_CLIENT_ID \
#   --from-literal=mgmt-client-secret=YOUR_AUTH0_MGMT_CLIENT_SECRET \
#   --namespace governance
#
# # Keycloak Credentials (if using Keycloak)
# kubectl create secret generic platform-keycloak \
#   --from-literal=service-account-client-id=YOUR_KEYCLOAK_SERVICE_ACCOUNT_CLIENT_ID \
#   --from-literal=service-account-client-secret=YOUR_KEYCLOAK_SERVICE_ACCOUNT_CLIENT_SECRET \
#   --from-literal=token-exchange-private-key="$(openssl genrsa 2048)" \
#   --namespace governance
#
# # Microsoft Entra ID Credentials (if using Entra)
# kubectl create secret generic platform-entra \
#   --from-literal=client-id=YOUR_ENTRA_CLIENT_ID \
#   --from-literal=client-secret=YOUR_ENTRA_CLIENT_SECRET \
#   --from-literal=tenant-id=YOUR_ENTRA_TENANT_ID \
#   --from-literal=graph-client-id=YOUR_GRAPH_CLIENT_ID \
#   --from-literal=graph-client-secret=YOUR_GRAPH_CLIENT_SECRET \
#   --namespace governance
#
# # Auth Service Credentials
# kubectl create secret generic platform-auth-service \
#   --from-literal=api-secret="$(openssl rand -base64 32)" \
#   --from-literal=jwt-secret="$(openssl rand -base64 32)" \
#   --namespace governance
#
# # Azure Blob Credentials (if using Azure Blob)
# kubectl create secret generic platform-azure-blob \
#   --from-literal=account-key=YOUR_AZURE_STORAGE_ACCOUNT_KEY \
#   --from-literal=connection-string="DefaultEndpointsProtocol=https;..." \
#   --namespace governance
#
# # GCS Credentials (if using GCS)
# kubectl create secret generic platform-gcs \
#   --from-literal=service-account-json="$(cat service-account.json)" \
#   --namespace governance
#
# # AWS S3 Credentials (if using S3)
# kubectl create secret generic platform-aws-s3 \
#   --from-literal=access-key-id=YOUR_AWS_ACCESS_KEY \
#   --from-literal=secret-access-key=YOUR_AWS_SECRET_KEY \
#   --namespace governance
#
# # Azure Key Vault Credentials
# kubectl create secret generic platform-azure-key-vault \
#   --from-literal=client-id=YOUR_AZURE_CLIENT_ID \
#   --from-literal=client-secret=YOUR_AZURE_CLIENT_SECRET \
#   --from-literal=tenant-id=YOUR_AZURE_TENANT_ID \
#   --from-literal=vault-url=https://your-vault.vault.azure.net/ \
#   --namespace governance
#
# # Encryption Key Credentials
# kubectl create secret generic platform-encryption-key \
#   --from-literal=encryption-key="$(openssl rand -base64 32)" \
#   --namespace governance
#
# # Governance Worker Credentials
# kubectl create secret generic platform-governance-worker \
#   --from-literal=encryption-key="$(openssl rand -base64 32)" \
#   --from-literal=client-id=YOUR_M2M_CLIENT_ID \
#   --from-literal=client-secret=YOUR_M2M_CLIENT_SECRET \
#   --namespace governance
#
# # Image pull secret for GitHub Container Registry
# kubectl create secret docker-registry platform-image-pull-secret \
#   --docker-server=ghcr.io \
#   --docker-username=YOUR_GITHUB_USERNAME \
#   --docker-password=YOUR_GITHUB_PAT \
#   --docker-email=YOUR_EMAIL \
#   --namespace governance
