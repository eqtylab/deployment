# =============================================================================
# GOVERNANCE SERVICE - HELM VALUES CONFIGURATION
# =============================================================================
# This values file configures the Governance Service backend API.
#
# When deployed via the umbrella chart (governance-platform), most values
# are auto-configured from global settings.
# =============================================================================

# -- Enable Service
# @default -- `true`
# Enable the Governance Service backend API
enabled: true

# -- Replica Count
# @default -- `2`
# Number of pod replicas to run (ignored if autoscaling.enabled is true)
replicaCount: 2

# -- Image Configuration
# @default -- See values below
# Container image settings for Governance Service
image:
  # -- Image Repository
  # @default -- `ghcr.io/eqtylab/governance-service`
  repository: ghcr.io/eqtylab/governance-service
  # -- Image Pull Policy
  # @default -- `IfNotPresent`
  # Options: IfNotPresent, Always, Never
  pullPolicy: IfNotPresent
  # -- Image Tag
  # @default -- `""` (uses chart appVersion)
  tag: ""

# -- Container Command
# @default -- `["./governance-service"]`
# Container entrypoint command
command: ["./governance-service"]

# -- Container Arguments
# @default -- `[]`
# Available options: -debug-config, -debug-config-only, -show-secrets, -help
args: []

# -- Image Pull Secrets
# @default -- `[]` (auto-configured from global.secrets.imageRegistry.secretName)
# Additional secrets for pulling images from private registries
imagePullSecrets: []

# -- Name Override
# @default -- `""`
# Override the chart name used for resource naming
nameOverride: ""

# -- Full Name Override
# @default -- `""`
# Override the full name used for resource naming
fullnameOverride: ""

# -- Service Account Configuration
# @default -- See values below
serviceAccount:
  # -- Create Service Account
  # @default -- `false`
  create: false
  # -- Automount API Credentials
  # @default -- `true`
  automount: true
  # -- Service Account Annotations
  # @default -- `{}`
  annotations: {}
  # -- Service Account Name
  # @default -- `""` (generated if create is true)
  name: ""

# -- Pod Annotations
# @default -- `{}`
# Additional annotations to add to pods
podAnnotations: {}

# -- Pod Labels
# @default -- `{}`
# Additional labels to add to pods
podLabels: {}

# -- Pod Security Context
# @default -- `{}`
# Security context applied at the pod level
podSecurityContext: {}
  # fsGroup: 2000

# -- Container Security Context
# @default -- `{}`
# Security context applied at the container level
securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

# -- Service Configuration
# @default -- See values below
service:
  # -- Enable Service
  # @default -- `true`
  enabled: true
  # -- Service Type
  # @default -- `ClusterIP`
  # Options: ClusterIP, NodePort, LoadBalancer
  type: ClusterIP
  # -- Service Port
  # @default -- `10001`
  port: 10001

# -- Ingress Configuration
# @default -- See values below
ingress:
  # -- Enable Ingress
  # @default -- `false`
  enabled: false
  # -- Ingress Class Name
  # @default -- `""`
  # Example: "nginx", "traefik"
  className: ""
  # -- Ingress Annotations
  # @default -- `{}`
  annotations: {}
    # cert-manager.io/issuer: "letsencrypt-prod"
    # nginx.ingress.kubernetes.io/rewrite-target: /$2
    # nginx.ingress.kubernetes.io/proxy-body-size: "64m"
  # -- Ingress Hosts
  # @default -- See values below
  hosts:
    - host: governance.example.com
      paths:
        # Path uses regex for nginx rewrite - requires rewrite-target annotation
        - path: "/governanceService(/|$)(.*)"
          pathType: ImplementationSpecific
  # -- TLS Configuration
  # @default -- `[]`
  tls: []
    # - secretName: governance-service-tls
    #   hosts:
    #     - governance.example.com

# -- Resource Configuration
# @default -- `{}`
# CPU and memory resource requests and limits
resources: {}
  # requests:
  #   cpu: 250m
  #   memory: 256Mi
  # limits:
  #   cpu: 500m
  #   memory: 512Mi

# -- Autoscaling Configuration
# @default -- See values below
autoscaling:
  # -- Enable Autoscaling
  # @default -- `false`
  enabled: false
  # -- Minimum Replicas
  # @default -- `1`
  minReplicas: 1
  # -- Maximum Replicas
  # @default -- `100`
  maxReplicas: 100
  # -- Target CPU Utilization
  # @default -- `80`
  targetCPUUtilizationPercentage: 80
  # -- Target Memory Utilization
  # @default -- `80`
  targetMemoryUtilizationPercentage: 80

# -- Pod Disruption Budget
# @default -- See values below
podDisruptionBudget:
  # -- Enable PDB
  # @default -- `true`
  enabled: true
  # -- Minimum Available
  # @default -- `1`
  # Only rendered when replicaCount > 1
  minAvailable: 1
  # -- Maximum Unavailable
  # @default -- `1`
  # Only rendered when replicaCount <= 1; allows eviction of single-replica pods during node drains
  # Setting this to `0` may block node drains and cluster upgrades
  maxUnavailable: 1

# -- Node Selector
# @default -- `{}`
# Node labels for pod assignment
nodeSelector: {}

# -- Tolerations
# @default -- `[]`
# Tolerations for pod assignment
tolerations: []

# -- Affinity
# @default -- `{}`
# Affinity rules for pod assignment
affinity: {}

# -- Init Containers
# @default -- `[]`
# Init containers to add to the pod
initContainers: []

# -- Startup Probe
# @default -- See values below
startupProbe:
  httpGet:
    path: /health
    port: http
  failureThreshold: 30
  periodSeconds: 10

# -- Liveness Probe
# @default -- See values below
livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 10
  periodSeconds: 10
  failureThreshold: 3

# -- Readiness Probe
# @default -- See values below
readinessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5
  failureThreshold: 2

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

# -- External Database Configuration
# @default -- See values below
externalDatabase:
  # -- Database Host
  # @default -- `""` (auto-generated: "{Release.Name}-postgresql")
  host: ""
  # -- Database Port
  # @default -- `5432`
  port: 5432
  # -- Database Name
  # @default -- `governance`
  name: "governance"
  # -- Database User
  # @default -- `postgres`
  user: "postgres"
  # -- Database Password
  # @default -- `""` (auto-configured from global.secrets.database)
  password: ""
  # -- SSL Mode
  # @default -- `disable`
  # Options: disable, require, verify-ca, verify-full
  sslMode: "disable"

  # -- Password Secret Reference
  # @default -- See values below
  passwordSecretKeyRef:
    # -- Secret Name
    # @default -- `""` (auto-configured from global.secrets.database.secretName)
    name: ""
    # -- Secret Key
    # @default -- `password`
    key: "password"

# -- Database Migrations
# @default -- See values below
migrations:
  # -- Run at Startup
  # @default -- `true`
  # Run database migrations automatically at startup
  runAtStartup: true
  # -- Migration Path
  # @default -- `/app/migrations`
  # Path to migration files within the container
  path: "/app/migrations"

# =============================================================================
# SECRETS CONFIGURATION
# =============================================================================

# -- Secrets Configuration
# @default -- See values below
secrets:
  # -- Encryption Secret
  # @default -- See values below
  encryption:
    # -- Secret Name
    # @default -- `""` (auto-configured from global.secrets.encryption.secretName)
    name: ""

  # -- Auth Provider Secrets
  # @default -- See values below
  # Only configure the section matching your auth provider
  auth:
    # -- Auth0 Secret
    # @default -- See values below
    # Only used when auth provider is "auth0"
    auth0:
      # -- Secret Name
      # @default -- `""` (auto-configured from global.secrets.auth.auth0.secretName)
      name: ""
    # -- Keycloak Secret
    # @default -- See values below
    # Only used when auth provider is "keycloak"
    keycloak:
      # -- Secret Name
      # @default -- `""` (auto-configured from global.secrets.auth.keycloak.secretName)
      name: ""
    # -- Entra Secret
    # @default -- See values below
    # Only used when auth provider is "entra"
    entra:
      # -- Secret Name
      # @default -- `""` (auto-configured from global.secrets.auth.entra.secretName)
      name: ""

  # -- Storage Secrets
  # @default -- See values below
  # Only configure the section matching your storage provider
  storage:
    # -- Azure Blob Storage Secret
    # @default -- See values below
    # Only used when storageProvider is "azure_blob"
    azure_blob:
      # -- Secret Name
      # @default -- `""` (auto-configured from global.secrets.storage.azure_blob.secretName)
      name: ""

    # -- AWS S3 Secret
    # @default -- See values below
    # Only used when storageProvider is "aws_s3"
    aws_s3:
      # -- Secret Name
      # @default -- `""` (auto-configured from global.secrets.storage.aws_s3.secretName)
      name: ""

    # -- GCS Secret
    # @default -- See values below
    # Only used when storageProvider is "gcs"
    gcs:
      # -- Secret Name
      # @default -- `""` (auto-configured from global.secrets.storage.gcs.secretName)
      name: ""

  # -- Auth Service Secret
  # @default -- See values below
  # Secret containing the auth service API key for worker authentication
  authService:
    # -- Secret Name
    # @default -- `""` (auto-configured from global.secrets.authService.secretName)
    name: ""

# =============================================================================
# APPLICATION CONFIGURATION
# =============================================================================

# -- Application Configuration
# @default -- See values below
config:
  # -- Health Check Path
  # @default -- `/health`
  healthPath: "/health"

  # -- Application Environment
  # @default -- `""` (auto-configured from global.environmentType, defaults to "development")
  appEnv: ""

  # -- Log Level
  # @default -- `info`
  # Options: debug, info, warn, error
  logLevel: "info"

  # -- Credential Encryption Key
  # @default -- `""` (auto-configured from global.secrets.encryption)
  credentialEncryptionKey: ""

  # ---------------------------------------------------------------------------
  # HTTP Server Configuration
  # ---------------------------------------------------------------------------

  # -- Server Configuration
  # @default -- See values below
  server:
    # -- Read Timeout
    # @default -- `30`
    # Maximum time to read request (seconds)
    readTimeout: 30
    # -- Write Timeout
    # @default -- `30`
    # Maximum time to write response (seconds)
    writeTimeout: 30
    # -- Idle Timeout
    # @default -- `120`
    # Maximum idle time for connections (seconds)
    idleTimeout: 120
    # -- Swagger Enabled
    # @default -- `true`
    # Enable Swagger documentation
    swaggerEnabled: true
    # -- Swagger Host
    # @default -- `""` (auto-generated from global.domain)
    # Only used when swaggerEnabled is true
    swaggerHost: ""
    # -- Swagger Base Path
    # @default -- `/governanceService`
    # Only used when swaggerEnabled is true
    swaggerBasePath: "/governanceService"

  # ---------------------------------------------------------------------------
  # Storage Configuration
  # ---------------------------------------------------------------------------

  # -- Storage Provider
  # @default -- `""`
  # **REQUIRED**: Cloud storage provider
  # Options: gcs, azure_blob, aws_s3
  storageProvider: ""

  # -- GCS Bucket Name
  # @default -- `""`
  # **REQUIRED for GCS**: Bucket name
  # Only used when storageProvider is "gcs"
  gcsBucketName: ""

  # -- AWS S3 Region
  # @default -- `""`
  # **REQUIRED for S3**: AWS region (e.g., "us-east-1")
  # Only used when storageProvider is "aws_s3"
  awsS3Region: ""

  # -- AWS S3 Bucket Name
  # @default -- `""`
  # **REQUIRED for S3**: Bucket name
  # Only used when storageProvider is "aws_s3"
  awsS3BucketName: ""

  # -- AWS S3 Access Key ID
  # @default -- `""` (auto-configured from global.secrets.storage.aws_s3)
  # Only used when storageProvider is "aws_s3"
  awsS3AccessKeyId: ""

  # -- AWS S3 Secret Access Key
  # @default -- `""` (auto-configured from global.secrets.storage.aws_s3)
  # Only used when storageProvider is "aws_s3"
  awsS3SecretAccessKey: ""

  # -- Azure Storage Account Name
  # @default -- `""`
  # **REQUIRED for Azure**: Storage account name
  # Only used when storageProvider is "azure_blob"
  azureStorageAccountName: ""

  # -- Azure Storage Account Key
  # @default -- `""` (auto-configured from global.secrets.storage.azure_blob)
  # Only used when storageProvider is "azure_blob"
  azureStorageAccountKey: ""

  # -- Azure Storage Connection String
  # @default -- `""` (auto-configured from global.secrets.storage.azure_blob)
  # Only used when storageProvider is "azure_blob"
  azureStorageConnectionString: ""

  # -- Azure Storage Container Name
  # @default -- `""`
  # **REQUIRED for Azure**: Container name
  # Only used when storageProvider is "azure_blob"
  azureStorageContainerName: ""

  # -- Azure Use Managed Identity
  # @default -- `false`
  # Use Azure managed identity instead of account key
  # Only used when storageProvider is "azure_blob"
  azureUseManagedIdentity: false

  # ---------------------------------------------------------------------------
  # Authentication Provider Configuration
  # ---------------------------------------------------------------------------

  # -- Auth Provider
  # @default -- `""` (auto-configured from global.secrets.auth.provider, defaults to "auth0")
  # Options: auth0, keycloak, entra
  authProvider: ""

  # -- Auth0 Domain
  # @default -- `""`
  # **REQUIRED for Auth0**: Tenant domain (e.g., "yourcompany.us.auth0.com")
  # Only used when auth provider is "auth0"
  auth0Domain: ""

  # -- Auth0 Client ID
  # @default -- `""` (auto-configured from global.secrets.auth.auth0)
  # Only used when auth provider is "auth0"
  auth0ClientId: ""

  # -- Auth0 Client Secret
  # @default -- `""` (auto-configured from global.secrets.auth.auth0)
  # Only used when auth provider is "auth0"
  auth0ClientSecret: ""

  # -- Auth0 Sync at Startup
  # @default -- `true`
  # Sync Auth0 users at application startup
  # Only used when auth provider is "auth0"
  auth0SyncAtStartup: true

  # -- Auth0 Sync Page Size
  # @default -- `100`
  # Number of users to sync per page from Auth0
  # Only used when auth provider is "auth0"
  auth0SyncPageSize: 100

  # -- Keycloak URL
  # @default -- `""`
  # **REQUIRED for Keycloak**: Server URL (e.g., "https://keycloak.example.com")
  # Only used when auth provider is "keycloak"
  keycloakUrl: ""

  # -- Keycloak Realm
  # @default -- `""`
  # **REQUIRED for Keycloak**: Realm name (e.g., "governance")
  # Only used when auth provider is "keycloak"
  keycloakRealm: ""

  # -- Keycloak Client ID
  # @default -- `""` (auto-configured from global.secrets.auth.keycloak)
  # Only used when auth provider is "keycloak"
  keycloakClientId: ""

  # -- Keycloak Client Secret
  # @default -- `""` (auto-configured from global.secrets.auth.keycloak)
  # Only used when auth provider is "keycloak"
  keycloakClientSecret: ""

  # -- Entra Tenant ID
  # @default -- `""` (auto-configured from global.secrets.auth.entra)
  # **REQUIRED for Entra**: Microsoft Entra ID tenant ID
  # Only used when auth provider is "entra"
  entraTenantId: ""

  # -- Entra Client ID
  # @default -- `""` (auto-configured from global.secrets.auth.entra)
  # Only used when auth provider is "entra"
  entraClientId: ""

  # -- Entra Client Secret
  # @default -- `""` (auto-configured from global.secrets.auth.entra)
  # Only used when auth provider is "entra"
  entraClientSecret: ""

  # ---------------------------------------------------------------------------
  # Service Integration URLs
  # ---------------------------------------------------------------------------

  # -- Integrity Service URL
  # @default -- `""` (auto-generated: "http://{Release.Name}-integrity-service:3050")
  integrityServiceUrl: ""

  # -- Auth Service URL
  # @default -- `""` (auto-generated: "http://{Release.Name}-auth-service:8080")
  authServiceUrl: ""

  # ---------------------------------------------------------------------------
  # Service Account Configuration
  # ---------------------------------------------------------------------------

  # -- Service Account Configuration
  # @default -- See values below
  # Configuration for worker authentication
  serviceAccount:
    # -- Enable Service Account
    # @default -- `true`
    # Enable service account authentication for worker
    enabled: true
    # -- Auth Service URL
    # @default -- `""`
    # Auth service URL for token retrieval (falls back to config.authServiceUrl)
    authServiceUrl: ""
    # -- Auth Service API Key
    # @default -- `""` (auto-configured from global.secrets.authService)
    authServiceApiKey: ""
    # -- Service Name
    # @default -- `governance-worker`
    # Service account name
    serviceName: "governance-worker"
    # -- Existing Secret
    # @default -- `""` (falls back to secrets.authService)
    # Override secret name for API key
    existingSecret: ""
    # -- Existing Secret Keys
    # @default -- See values below
    existingSecretKeys:
      # -- API Key
      # @default -- `api-secret`
      apiKey: "api-secret"
