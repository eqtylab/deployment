# Default values for governance-service.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# -- Enable the Governance Service backend API
enabled: true

# -- Number of pod replicas to run (ignored if autoscaling.enabled is true)
replicaCount: 1

image:
  # -- Container image repository
  repository: ghcr.io/eqtylab/governance-service
  # -- Image pull policy (IfNotPresent | Always | Never)
  pullPolicy: IfNotPresent
  # -- Image tag override (defaults to chart appVersion if empty)
  tag: ""

# -- Container entrypoint command
command: ["./governance-service"]

# -- Container arguments
# @default -- `[]`
# Available options: -debug-config, -debug-config-only, -show-secrets, -help
args: []

# -- Image pull secrets for private registries
# @default -- Populated from global.secrets.imageRegistry.secretName in templates
imagePullSecrets: []

# -- Override the chart name used for resource naming
nameOverride: ""
# -- Override the full name used for resource naming
fullnameOverride: ""

serviceAccount:
  # -- Create a ServiceAccount for the deployment
  create: false
  # -- Automatically mount a ServiceAccount's API credentials
  automount: true
  # -- Annotations to add to the ServiceAccount
  annotations: {}
  # -- Name of an existing ServiceAccount to use (generated if empty and create is true)
  name: ""

# -- Additional annotations to add to pods
podAnnotations: {}

# -- Additional labels to add to pods
podLabels: {}

# -- Security context applied at the pod level
podSecurityContext: {}
  # fsGroup: 2000

# -- Security context applied at the container level
securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

service:
  # -- Create a Kubernetes Service
  enabled: true
  # -- Service type (ClusterIP | NodePort | LoadBalancer)
  type: ClusterIP
  # -- Service port
  port: 10001

ingress:
  # -- Create an Ingress resource for external access
  enabled: false
  # -- IngressClass name (e.g., "nginx", "traefik")
  className: ""
  # -- Additional annotations for the Ingress resource
  annotations: {}
    # cert-manager.io/issuer: "letsencrypt-prod"
    # nginx.ingress.kubernetes.io/rewrite-target: /$2
    # nginx.ingress.kubernetes.io/proxy-body-size: "64m"
  # -- Ingress host configuration
  hosts:
    - host: governance.example.com
      paths:
        # Path uses regex for nginx rewrite - requires rewrite-target annotation
        - path: "/governanceService(/|$)(.*)"
          pathType: ImplementationSpecific
  # -- TLS configuration
  tls: []
    # - secretName: governance-service-tls
    #   hosts:
    #     - governance.example.com

# -- Resource requests and limits
resources: {}
  # requests:
  #   cpu: 250m
  #   memory: 256Mi
  # limits:
  #   cpu: 500m
  #   memory: 512Mi

# Horizontal Pod Autoscaler - automatically scales pods based on resource usage
autoscaling:
  # -- Enable Horizontal Pod Autoscaler
  enabled: false
  # -- Minimum number of replicas
  minReplicas: 1
  # -- Maximum number of replicas
  maxReplicas: 100
  # -- Target CPU utilization percentage
  targetCPUUtilizationPercentage: 80
  # -- Target memory utilization percentage
  targetMemoryUtilizationPercentage: 80

# Pod Disruption Budget - maintains availability during cluster disruptions
podDisruptionBudget:
  # -- Minimum available pods during disruptions (only applied when autoscaling is enabled or replicaCount > 1)
  minAvailable: 1

# -- Node labels for pod assignment
nodeSelector: {}

# -- Tolerations for pod assignment
tolerations: []

# -- Affinity rules for pod assignment
affinity: {}

# -- Startup probe configuration
startupProbe:
  httpGet:
    path: /health
    port: http
  failureThreshold: 30
  periodSeconds: 10

# -- Liveness probe configuration
livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 10
  periodSeconds: 10
  failureThreshold: 3

# -- Readiness probe configuration
readinessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5
  failureThreshold: 2

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

# -- External Database configuration
externalDatabase:
  # -- Database host
  # @default -- Generated as "{Release.Name}-postgresql" in templates
  host: ""
  # -- Database port
  port: 5432
  # -- Database name
  database: "governance"
  # -- Database user
  user: "assurance"
  # -- Database password (leave empty to use secret reference)
  password: ""
  # -- SSL mode (disable | require | verify-ca | verify-full)
  sslmode: "disable"

  # -- Database password secret reference
  passwordSecretKeyRef:
    # -- Secret name containing database credentials
    # @default -- Populated from global.secrets.database.secretName in templates
    name: ""
    # -- Secret key name for database password
    # @default -- Populated from global.secrets.database.keys.password in templates
    key: ""

# -- Database migration configuration
migrations:
  # -- Run database migrations automatically at startup
  runAtStartup: true
  # -- Path to migration files within the container
  path: "/app/migrations"

# =============================================================================
# SECRET CONFIGURATION
# =============================================================================

secrets:
  # -- Encryption key secret reference
  encryption:
    # -- Secret name containing encryption key
    # @default -- Populated from global.secrets.encryption.secretName in templates
    name: ""
    # -- Secret key name for encryption key
    # @default -- Populated from global.secrets.encryption.keys.key in templates
    key: ""

  # -- Auth0 secret reference (only used when auth provider is Auth0)
  auth0:
    # -- Secret name containing Auth0 credentials
    # @default -- Populated from global.secrets.auth.auth0.secretName in templates
    name: ""
    # -- Secret key name for Auth0 client ID
    # @default -- Populated from global.secrets.auth.auth0.keys.clientId in templates
    clientIdKey: ""
    # -- Secret key name for Auth0 client secret
    # @default -- Populated from global.secrets.auth.auth0.keys.clientSecret in templates
    clientSecretKey: ""

  # -- Keycloak secret reference (only used when auth provider is Keycloak)
  keycloak:
    # -- Enable Keycloak instead of Auth0
    # @default -- Auto-detected from global.secrets.auth.provider in templates
    enabled: false
    # -- Secret name containing Keycloak configuration
    # @default -- Populated from global.secrets.auth.keycloak.secretName in templates
    existingSecret: ""
    # -- Secret keys for Keycloak configuration
    existingSecretKeys:
      clientId: "KEYCLOAK_CLIENT_ID"
      realm: "KEYCLOAK_REALM"
      url: "KEYCLOAK_URL"
    # -- Client secret reference
    existingClientSecretKeyRef:
      # -- Secret name containing Keycloak client secret
      # @default -- Populated from global.secrets.auth.keycloak.secretName in templates
      name: ""
      # -- Secret key name for Keycloak client secret
      # @default -- Populated from global.secrets.auth.keycloak.keys.backendClientSecret in templates
      clientSecretKey: ""

  # -- Storage credentials (provider-specific)
  storage:
    # -- Azure Blob Storage secret reference (only used when storage provider is azure_blob)
    azure_blob:
      # -- Secret name containing Azure storage credentials
      # @default -- Populated from global.secrets.storage.azure_blob.secretName in templates
      name: ""
      # -- Secret key name for Azure storage account name
      # @default -- Populated from global.secrets.storage.azure_blob.keys.accountName in templates
      accountNameKey: ""
      # -- Secret key name for Azure storage account key
      # @default -- Populated from global.secrets.storage.azure_blob.keys.accountKey in templates
      accountKeyKey: ""
      # -- Secret key name for Azure storage connection string
      # @default -- Populated from global.secrets.storage.azure_blob.keys.connectionString in templates
      connectionStringKey: ""

    # -- AWS S3 secret reference (only used when storage provider is aws_s3)
    aws_s3:
      # -- Secret name containing AWS credentials
      # @default -- Populated from global.secrets.storage.aws_s3.secretName in templates
      name: ""
      # -- Secret key name for AWS access key ID
      # @default -- Populated from global.secrets.storage.aws_s3.keys.accessKeyId in templates
      accessKeyIdKey: ""
      # -- Secret key name for AWS secret access key
      # @default -- Populated from global.secrets.storage.aws_s3.keys.secretAccessKey in templates
      secretAccessKeyKey: ""

    # -- GCS secret reference (only used when storage provider is gcs)
    gcs:
      # -- Secret name containing GCS credentials
      # @default -- Populated from global.secrets.storage.gcs.secretName in templates
      name: ""
      # -- Secret key name for service account JSON
      # @default -- Populated from global.secrets.storage.gcs.keys.serviceAccountJson in templates
      serviceAccountJsonKey: ""

  # -- Worker secret reference (for worker authentication)
  worker:
    # -- Secret name containing worker credentials
    # @default -- Populated from global.secrets.governanceWorker.secretName in templates
    name: ""
    # -- Secret key name for encryption key
    # @default -- Populated from global.secrets.governanceWorker.keys.encryptionKey in templates
    encryptionKeyKey: ""
    # -- Secret key name for client ID
    # @default -- Populated from global.secrets.governanceWorker.keys.clientId in templates
    clientIdKey: ""
    # -- Secret key name for client secret
    # @default -- Populated from global.secrets.governanceWorker.keys.clientSecret in templates
    clientSecretKey: ""

# =============================================================================
# APPLICATION CONFIGURATION
# =============================================================================

# Auth0 sync configuration (only used when auth provider is Auth0)
# -- Sync Auth0 users at application startup
auth0SyncAtStartup: true
# -- Number of users to sync per page from Auth0
auth0SyncPageSize: 100

# Application configuration
config:
  # -- Health check endpoint path
  path: "/health"

  # -- Application environment (development | staging | production)
  # @default -- Populated from global.environmentType in templates
  appEnv: ""

  # -- Logging level (debug | info | warn | error)
  logLevel: "info"

  # -- HTTP server configuration
  server:
    # -- Maximum time to read request (seconds)
    readTimeout: 30
    # -- Maximum time to write response (seconds)
    writeTimeout: 30
    # -- Maximum idle time for connections (seconds)
    idleTimeout: 120

  # -- Indicator configuration management
  indicators:
    # -- Path to indicator configuration files
    configPath: "/app/configs/indicators"
    # -- How often to reload configs (seconds)
    reloadInterval: 300
    # -- Enable OS guardrails
    osGuardrailsEnabled: false
    # -- Batch size for OS guardrails
    osGuardrailsBatchSize: 100
    # -- Timeout for OS guardrails (seconds)
    osGuardrailsTimeoutSeconds: 5

  # -- Cloud storage provider (gcs | azure | aws_s3)
  # @default -- `""` (must be set explicitly for this service)
  storageProvider: ""

  # -- Google Cloud Storage bucket name (only used when storageProvider is "gcs")
  # @default -- `""` (must be set when using GCS)
  gcsBucketName: ""

  # AWS S3 configuration (only used when storageProvider is "aws_s3")
  # -- AWS region
  # @default -- `""` (must be set when using S3)
  awsS3Region: ""
  # -- AWS S3 bucket name
  # @default -- `""` (must be set when using S3)
  awsS3BucketName: ""
  # -- AWS S3 folder/prefix
  # @default -- `""`
  awsS3Folder: ""
  # -- AWS access key ID (leave empty to use secret reference)
  # @default -- Secret reference (populated from secrets.storage.aws_s3 in templates)
  awsS3AccessKeyId: ""
  # -- AWS secret access key (leave empty to use secret reference)
  # @default -- Secret reference (populated from secrets.storage.aws_s3 in templates)
  awsS3SecretAccessKey: ""

  # Azure Storage configuration (only used when storageProvider is "azure")
  # -- Azure storage account name
  # @default -- Secret reference (populated from secrets.storage.azure_blob in templates)
  azureStorageAccountName: ""
  # -- Azure storage account key (leave empty to use secret reference)
  # @default -- Secret reference (populated from secrets.storage.azure_blob in templates)
  azureStorageAccountKey: ""
  # -- Azure storage connection string (leave empty to use secret reference)
  # @default -- Secret reference (populated from secrets.storage.azure_blob in templates)
  azureStorageConnectionString: ""
  # -- Azure storage container name
  # @default -- `""` (must be set when using Azure Blob)
  azureStorageContainerName: ""
  # -- Use Azure managed identity for authentication
  azureUseManagedIdentity: false

  # Auth0 configuration (only used when auth provider is Auth0)
  # -- Auth0 tenant domain
  # @default -- `""` (**must be set** when using Auth0)
  auth0Domain: ""
  # -- Auth0 client ID (leave empty to use secret reference)
  # @default -- Secret reference (populated from secrets.auth0 in templates)
  auth0ClientId: ""
  # -- Auth0 client secret (leave empty to use secret reference)
  # @default -- Secret reference (populated from secrets.auth0 in templates)
  auth0ClientSecret: ""

  # Integration URLs
  # -- Integrity Service URL
  # @default -- Generated as "https://{global.domain}/integrityService" in templates
  integrityServiceUrl: ""
  # -- Auth Service URL for permission validation
  # @default -- Generated as "https://{global.domain}/authService" in templates
  authServiceUrl: ""

  # -- Service account configuration (for worker authentication)
  serviceAccount:
    # -- Enable service account authentication for worker
    enabled: true
    # -- Auth service URL for token retrieval
    # @default -- Falls back to config.authServiceUrl in templates
    authServiceUrl: ""
    # -- API key for auth service (auto-generated if using auth-service subchart)
    authServiceApiKey: ""
    # -- Service account name
    serviceName: "governance-worker"
    # -- Use existing secret for API key
    existingSecret: ""
    # -- Secret keys
    existingSecretKeys:
      apiKey: "api-secret"

  # -- AI configuration
  ai:
    # -- Enable AI features
    enabled: true
    # -- AI provider (anthropic)
    provider: "anthropic"
    # -- AI model name
    model: "claude-3-7-sonnet-latest"
    # -- Temperature for AI responses
    temperature: 0.7
    # -- Maximum tokens for AI responses
    maxTokens: 4000
    # -- Timeout for AI requests (seconds)
    timeoutSeconds: 60
    # -- Number of retry attempts for AI requests
    retryAttempts: 3
    # -- AI API key secret reference
    secretKeyRef:
      # -- Secret name containing AI API key
      # @default -- Populated from global.secrets.governanceServiceAI.secretName in templates
      name: ""
      # -- Secret key name for AI API key
      # @default -- Populated from global.secrets.governanceServiceAI.keys.apiKey in templates
      key: ""
    # -- AI API key (leave empty to use secret reference)
    # @default -- Secret reference (populated from secretKeyRef in templates)
    apiKey: ""
    # -- Use V2 API
    useV2: true
