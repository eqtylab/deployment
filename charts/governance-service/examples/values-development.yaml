# Development/Local Configuration
# Minimal configuration for local development and testing
#
# Usage:
#   helm install governance-service ./charts/governance-service -f examples/values-development.yaml
#
# Prerequisites:
#   - Local PostgreSQL (or docker-compose)
#   - Auth0 development tenant
#   - Local file storage or MinIO for S3-compatible storage
#
# This example demonstrates:
#   - Minimal required configuration for development
#   - Debug-level logging
#   - Single replica (no HA)
#   - Relaxed security settings

# =============================================================================
# APPLICATION CONFIGURATION
# =============================================================================

config:
  appEnv: "development"
  logLevel: "debug"

  server:
    readTimeout: 60
    writeTimeout: 60
    idleTimeout: 300

  # For development, you can use local file storage or MinIO
  # Option 1: AWS S3 with MinIO
  storageProvider: "aws_s3"
  awsS3Region: "us-east-1"
  awsS3BucketName: "governance-dev"
  awsS3Folder: ""
  # For MinIO, set endpoint via environment variable
  # AWS_ENDPOINT_URL: "http://minio:9000"

  # Option 2: Azure Blob (local emulator - Azurite)
  # storageProvider: "azure_blob"
  # azureStorageContainerName: "governance-dev"
  # azureUseManagedIdentity: false

  # Auth0 development tenant
  auth0Domain: "dev-your-tenant.auth0.com"

  # Local service URLs
  integrityServiceUrl: "http://integrity-service:3050"
  authServiceUrl: "http://auth-service:8080"

  # Indicator configuration
  indicators:
    configPath: "/app/configs/indicators"
    reloadInterval: 60 # Faster reload for development
    osGuardrailsEnabled: false

  # Service account can be disabled for simpler development
  serviceAccount:
    enabled: false

  # AI features - can be disabled to save costs
  ai:
    enabled: false # Set to true if you need AI features
    provider: "anthropic"
    model: "claude-3-haiku-20240307" # Cheaper model for development
    temperature: 0.7
    maxTokens: 2000
    timeoutSeconds: 30
    retryAttempts: 1
    useV2: true

# Auth0 sync
auth0SyncAtStartup: false # Disable for faster startup
auth0SyncPageSize: 50

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

externalDatabase:
  host: "localhost"
  port: 5432
  database: "governance_dev"
  user: "postgres"
  password: "postgres" # Inline password OK for development
  sslmode: "disable"

migrations:
  runAtStartup: true
  path: "/app/migrations"

# =============================================================================
# SECRET CONFIGURATION
# =============================================================================

secrets:
  encryption:
    name: "dev-encryption"
    key: "key"

  auth0:
    name: "dev-auth0"
    clientIdKey: "client-id"
    clientSecretKey: "client-secret"

  storage:
    aws_s3:
      name: "dev-minio"
      accessKeyIdKey: "access-key"
      secretAccessKeyKey: "secret-key"

# =============================================================================
# DEPLOYMENT CONFIGURATION
# =============================================================================

# Single replica for development
replicaCount: 1

image:
  repository: ghcr.io/eqtylab/governance-service
  pullPolicy: IfNotPresent
  tag: "" # Use latest or specific dev version

imagePullSecrets: []

serviceAccount:
  create: false
  automount: false
  name: ""

# Minimal resources for local development
resources:
  requests:
    cpu: 50m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 512Mi

# No autoscaling for development
autoscaling:
  enabled: false

# =============================================================================
# SERVICE CONFIGURATION
# =============================================================================

service:
  enabled: true
  type: ClusterIP
  port: 10001

# No ingress for development - use port-forward
ingress:
  enabled: false

# =============================================================================
# SECURITY (RELAXED FOR DEVELOPMENT)
# =============================================================================

podSecurityContext: {}

securityContext: {}

# No PDB for development
podDisruptionBudget:
  minAvailable: 0

# No affinity for development
affinity: {}
nodeSelector: {}
tolerations: []

# =============================================================================
# PROBES (RELAXED FOR DEVELOPMENT)
# =============================================================================

startupProbe:
  httpGet:
    path: /health
    port: http
  failureThreshold: 60 # More time for slow startup
  periodSeconds: 5

livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 30
  periodSeconds: 30
  failureThreshold: 5

readinessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 10
  periodSeconds: 10
  failureThreshold: 5

# =============================================================================
# DEBUG CONFIGURATION
# =============================================================================

# Enable debug config output on startup
args:
  - "-debug-config"

# Additional debug annotations
podAnnotations:
  sidecar.istio.io/inject: "false"

podLabels:
  environment: "development"
