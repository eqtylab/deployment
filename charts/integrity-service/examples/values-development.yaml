# Development/Local Configuration
# Configuration optimized for local development and testing
#
# Usage:
#   helm install integrity-service ./charts/integrity-service -f examples/values-development.yaml
#
# Prerequisites:
#   - Local Kubernetes cluster (minikube, kind, Docker Desktop)
#   - Local PostgreSQL or docker-compose database
#   - MinIO for S3-compatible storage (or Azure Storage Emulator)
#   - Auth service running locally
#
# This example demonstrates:
#   - Single replica (no HA)
#   - Debug logging enabled
#   - Minimal resource requirements
#   - Relaxed security settings for debugging
#   - Local persistence option

# =============================================================================
# DEPLOYMENT CONFIGURATION
# =============================================================================

# Single replica for development
replicaCount: 1

image:
  repository: ghcr.io/eqtylab/integrity-service
  pullPolicy: IfNotPresent
  tag: "" # Use latest or specific dev version

imagePullSecrets: []

serviceAccount:
  create: false
  automount: false
  name: ""

# Minimal resources for local development
resources:
  requests:
    cpu: 50m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 512Mi

# No autoscaling for development
autoscaling:
  enabled: false

# =============================================================================
# SERVICE CONFIGURATION
# =============================================================================

service:
  enabled: true
  type: ClusterIP
  port: 3050

# No ingress for development - use port-forward:
#   kubectl port-forward svc/integrity-service 3050:3050
ingress:
  enabled: false

# =============================================================================
# PERSISTENCE (OPTIONAL FOR DEVELOPMENT)
# =============================================================================

# Enable persistence for data retention across restarts
persistence:
  enabled: false
  integrity:
    mountPath: /data/integrity
    hostPath: /var/lib/integrity

# =============================================================================
# APPLICATION CONFIGURATION
# =============================================================================

env:
  # Development environment
  rustEnv: "development"

  # Local database
  integrityAppDbHost: "localhost"
  integrityAppDbName: "IntegrityServiceDB"
  integrityAppDbUser: "postgres"
  # For development, can use inline password (NOT for production!)
  integrityAppDbPassword: "postgres"

  # Storage - MinIO (S3-compatible) for local development
  integrityAppBlobStoreType: "aws_s3"
  integrityAppBlobStoreRegion: "us-east-1"
  integrityAppBlobStoreBucket: "integrity-dev"
  integrityAppBlobStoreFolder: ""
  # For MinIO, set AWS_ENDPOINT_URL environment variable
  # e.g., AWS_ENDPOINT_URL: "http://minio:9000"

  # Alternative: Azure Storage Emulator (Azurite)
  # integrityAppBlobStoreType: "azure_blob"
  # integrityAppBlobStoreContainer: "integrity-dev"

  # Debug logging
  integrityAppLoggingLogLevelDefault: "debug"
  integrityAppLoggingLogLevelIntegrityService: "trace"

  # Auth service URL (local)
  integrityAppAuthType: "auth_service"
  integrityAppAuthUrl: "http://auth-service:8080"

  # Auth signer - Azure Key Vault (still required for signing)
  integrityAppAuthSignerConfigType: "azure_key_vault"

  # Service URL for local development
  integrityServiceUrl: "http://localhost:3050"

# =============================================================================
# SECRET CONFIGURATION
# =============================================================================

secrets:
  # Database credentials (optional for dev if using inline password)
  database:
    enabled: false

  # Storage credentials for MinIO
  storage:
    aws_s3:
      enabled: true
      name: "dev-minio"
      keys:
        accessKeyId: "access-key"
        secretAccessKey: "secret-key"

  # Azure Key Vault (still needed for signing operations)
  secretManager:
    azure_key_vault:
      enabled: true
      name: "dev-azure-key-vault"
      keys:
        clientId: "client-id"
        clientSecret: "client-secret"
        tenantId: "tenant-id"
        vaultUrl: "vault-url"

# =============================================================================
# SECURITY (RELAXED FOR DEVELOPMENT)
# =============================================================================

podSecurityContext: {}

securityContext:
  readOnlyRootFilesystem: false

# No PDB for development
podDisruptionBudget:
  minAvailable: 0

# No affinity for development
affinity: {}
nodeSelector: {}
tolerations: []

# =============================================================================
# PROBES (RELAXED FOR DEVELOPMENT)
# =============================================================================

startupProbe:
  httpGet:
    path: /health/v1
    port: http
  failureThreshold: 60 # More time for slow startup
  periodSeconds: 5

livenessProbe:
  httpGet:
    path: /health/v1
    port: http
  initialDelaySeconds: 30
  periodSeconds: 30
  failureThreshold: 5

readinessProbe:
  httpGet:
    path: /health/v1
    port: http
  initialDelaySeconds: 10
  periodSeconds: 10
  failureThreshold: 5

# =============================================================================
# POD LABELS
# =============================================================================

podLabels:
  environment: "development"

podAnnotations:
  sidecar.istio.io/inject: "false"
