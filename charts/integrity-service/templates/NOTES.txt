{{- if .Values.enabled }}
Integrity Service has been deployed!

Service URL (internal): http://{{ include "integrity-service.fullname" . }}:{{ .Values.service.port }}

{{- if .Values.ingress.enabled }}
External URL: {{ .Values.config.integrityServiceUrl | default (printf "https://%s/integrityService" ((.Values.global).domain | default "governance.example.com")) }}
{{- else }}

To access the service, you need to enable ingress or use port-forwarding:
  kubectl port-forward svc/{{ include "integrity-service.fullname" . }} 3050:{{ .Values.service.port }} -n {{ .Release.Namespace }}
  Then visit: http://localhost:3050/health/v1
{{- end }}

Configuration:
  Environment: {{ .Values.config.rustEnv | default ((.Values.global).environmentType | default "not set") }}
  Storage Provider: {{ .Values.config.integrityAppBlobStoreType | default "not set" }}
  Auth Type: {{ .Values.config.integrityAppAuthType }}

{{- if eq .Values.config.integrityAppBlobStoreType "azure_blob" }}
  Azure Storage Account: {{ .Values.config.integrityAppBlobStoreAccount | default "not set" }}
  Azure Container: {{ .Values.config.integrityAppBlobStoreContainer | default "not set" }}
{{- else if eq .Values.config.integrityAppBlobStoreType "aws_s3" }}
  AWS Region: {{ .Values.config.integrityAppBlobStoreAwsRegion | default "not set" }}
  AWS Bucket: {{ .Values.config.integrityAppBlobStoreAwsBucket | default "not set" }}
{{- else if eq .Values.config.integrityAppBlobStoreType "gcs" }}
  GCS Bucket: {{ .Values.config.integrityAppBlobStoreGcsBucket | default "not set" }}
  GCS Folder: {{ .Values.config.integrityAppBlobStoreGcsFolder | default "not set" }}
{{- end }}

To check the status:
  kubectl get pods -l app.kubernetes.io/name={{ include "integrity-service.name" . }} -n {{ .Release.Namespace }}

To view logs:
  kubectl logs -f deployment/{{ include "integrity-service.fullname" . }} -n {{ .Release.Namespace }}

To check environment configuration:
  kubectl exec -it deployment/{{ include "integrity-service.fullname" . }} -n {{ .Release.Namespace }} -- env | grep INTEGRITY_APP

{{- if not .Values.config.integrityAppBlobStoreType }}

⚠️  WARNING: Blob storage type is not configured!
Please set: integrity-service.config.integrityAppBlobStoreType to "azure_blob", "aws_s3", or "gcs"
{{- end }}

{{- if eq .Values.config.integrityAppBlobStoreType "azure_blob" }}
{{- if not .Values.config.integrityAppBlobStoreAccount }}

⚠️  WARNING: Azure storage account is not configured!
Please set: integrity-service.config.integrityAppBlobStoreAccount
{{- end }}
{{- if not .Values.config.integrityAppBlobStoreContainer }}

⚠️  WARNING: Azure blob container is not configured!
Please set: integrity-service.config.integrityAppBlobStoreContainer
{{- end }}
{{- end }}

{{- if eq .Values.config.integrityAppBlobStoreType "aws_s3" }}
{{- if or (not .Values.config.integrityAppBlobStoreAwsRegion) (not .Values.config.integrityAppBlobStoreAwsBucket) }}

⚠️  WARNING: AWS S3 configuration incomplete!
Please set: integrity-service.config.integrityAppBlobStoreAwsRegion and integrity-service.config.integrityAppBlobStoreAwsBucket
{{- end }}
{{- end }}

{{- if eq .Values.config.integrityAppBlobStoreType "gcs" }}
{{- if not .Values.config.integrityAppBlobStoreGcsBucket }}

⚠️  WARNING: GCS configuration incomplete!
Please set: integrity-service.config.integrityAppBlobStoreGcsBucket
{{- end }}
{{- end }}
{{- end }}
