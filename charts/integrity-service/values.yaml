# =============================================================================
# INTEGRITY SERVICE - HELM VALUES CONFIGURATION
# =============================================================================
# This values file configures the Integrity Service for lineage tracking
# and verifiable credentials management.
#
# When deployed via the umbrella chart (governance-platform), most values
# are auto-configured from global settings. For standalone deployment,
# you must configure database, storage, and auth settings manually.
# =============================================================================

# -- Enable Service
# @default -- `true`
# Enable the Integrity Service for lineage and verifiable credentials
enabled: true

# -- Replica Count
# @default -- `1`
# Number of pod replicas to run (ignored if autoscaling.enabled is true)
replicaCount: 1

# -- Image Configuration
# @default -- See values below
# Container image settings for the Integrity Service
image:
  # -- Image Repository
  # @default -- `ghcr.io/eqtylab/integrity-service`
  repository: ghcr.io/eqtylab/integrity-service
  # -- Image Pull Policy
  # @default -- `IfNotPresent`
  # Options: IfNotPresent, Always, Never
  pullPolicy: IfNotPresent
  # -- Image Tag
  # @default -- `""` (uses chart appVersion)
  tag: ""

# -- Image Pull Secrets
# @default -- `[]` (auto-configured from global.secrets.imageRegistry.secretName)
# Additional secrets for pulling images from private registries
imagePullSecrets: []

# -- Name Override
# @default -- `""`
# Override the chart name used for resource naming
nameOverride: ""

# -- Full Name Override
# @default -- `""`
# Override the full name used for resource naming
fullnameOverride: ""

# -- Service Account Configuration
# @default -- See values below
serviceAccount:
  # -- Create Service Account
  # @default -- `false`
  create: false
  # -- Automount API Credentials
  # @default -- `true`
  automount: true
  # -- Service Account Annotations
  # @default -- `{}`
  annotations: {}
  # -- Service Account Name
  # @default -- `""` (generated if create is true)
  name: ""

# -- Pod Annotations
# @default -- `{}`
# Additional annotations to add to pods
podAnnotations: {}

# -- Pod Labels
# @default -- `{}`
# Additional labels to add to pods
podLabels: {}

# -- Pod Security Context
# @default -- `{}`
# Security context applied at the pod level
podSecurityContext: {}
  # fsGroup: 2000

# -- Container Security Context
# @default -- See values below
# Security context applied at the container level
securityContext:
  # -- Read-Only Root Filesystem
  # @default -- `false`
  # Disabled to allow Rust app file operations
  readOnlyRootFilesystem: false

# -- Service Configuration
# @default -- See values below
service:
  # -- Enable Service
  # @default -- `true`
  enabled: true
  # -- Service Type
  # @default -- `ClusterIP`
  # Options: ClusterIP, NodePort, LoadBalancer
  type: ClusterIP
  # -- Service Port
  # @default -- `3050`
  port: 3050

# -- Ingress Configuration
# @default -- See values below
ingress:
  # -- Enable Ingress
  # @default -- `false`
  enabled: false
  # -- Ingress Class Name
  # @default -- `""`
  # Example: "nginx", "traefik"
  className: ""
  # -- Ingress Annotations
  # @default -- `{}`
  annotations: {}
    # cert-manager.io/issuer: "letsencrypt-prod"
    # nginx.ingress.kubernetes.io/rewrite-target: /$2
    # nginx.ingress.kubernetes.io/proxy-body-size: "64m"
  # -- Ingress Hosts
  # @default -- See values below
  hosts:
    - host: governance.example.com
      paths:
        # Path uses regex for nginx rewrite - requires rewrite-target annotation
        - path: "/integrityService(/|$)(.*)"
          pathType: ImplementationSpecific
  # -- TLS Configuration
  # @default -- `[]`
  tls: []
    # - secretName: integrity-service-tls
    #   hosts:
    #     - governance.example.com

# -- Resource Configuration
# @default -- `{}`
# CPU and memory resource requests and limits
resources: {}
  # requests:
  #   cpu: 100m
  #   memory: 256Mi
  # limits:
  #   cpu: 500m
  #   memory: 512Mi

# -- Autoscaling Configuration
# @default -- See values below
autoscaling:
  # -- Enable Autoscaling
  # @default -- `false`
  enabled: false
  # -- Minimum Replicas
  # @default -- `1`
  minReplicas: 1
  # -- Maximum Replicas
  # @default -- `100`
  maxReplicas: 100
  # -- Target CPU Utilization
  # @default -- `80`
  targetCPUUtilizationPercentage: 80
  # -- Target Memory Utilization
  # @default -- `80`
  targetMemoryUtilizationPercentage: 80

# -- Pod Disruption Budget
# @default -- See values below
podDisruptionBudget:
  # -- Enable PDB
  # @default -- `false`
  enabled: false
  # -- Minimum Available
  # @default -- `1`
  # Note: typically only applied when autoscaling is enabled or replicaCount > 1
  minAvailable: 1

# -- Node Selector
# @default -- `{}`
# Node labels for pod assignment
nodeSelector: {}

# -- Tolerations
# @default -- `[]`
# Tolerations for pod assignment
tolerations: []

# -- Affinity
# @default -- `{}`
# Affinity rules for pod assignment
affinity: {}

# -- Startup Probe
# @default -- See values below
startupProbe:
  httpGet:
    path: /health/v1
    port: http
  failureThreshold: 30
  periodSeconds: 10

# -- Liveness Probe
# @default -- See values below
livenessProbe:
  httpGet:
    path: /health/v1
    port: http
  initialDelaySeconds: 10
  periodSeconds: 10
  failureThreshold: 3

# -- Readiness Probe
# @default -- See values below
readinessProbe:
  httpGet:
    path: /health/v1
    port: http
  initialDelaySeconds: 5
  periodSeconds: 5
  failureThreshold: 2

# =============================================================================
# PERSISTENCE CONFIGURATION
# =============================================================================
persistence:
  # -- Enable Persistence
  # @default -- `false`
  # Enable persistent volume for integrity data
  enabled: false

  # -- Integrity Data Volume
  # @default -- See values below
  integrity:
    # -- Mount Path
    # @default -- `/data/integrity`
    mountPath: /data/integrity
    # -- Host Path
    # @default -- `/var/lib/integrity`
    # Only used when persistence.enabled is true
    hostPath: /var/lib/integrity

# =============================================================================
# APPLICATION CONFIGURATION
# =============================================================================
config:
  # -- Rust Environment
  # @default -- `""` (auto-configured from global.environmentType)
  rustEnv: ""

  # ---------------------------------------------------------------------------
  # Database Configuration
  # ---------------------------------------------------------------------------

  # -- Database Host
  # @default -- `""` (auto-generated: "{Release.Name}-postgresql")
  integrityAppDbHost: ""

  # -- Database Name
  # @default -- `IntegrityServiceDB`
  integrityAppDbName: "IntegrityServiceDB"

  # -- Database User
  # @default -- `""` (auto-configured from global.postgresql.username)
  integrityAppDbUser: ""

  # -- Database Password
  # @default -- `""` (auto-configured from secrets.database)
  # Leave empty to use secret reference (recommended)
  integrityAppDbPassword: ""

  # ---------------------------------------------------------------------------
  # Storage Configuration
  # ---------------------------------------------------------------------------

  # -- Blob Store Type
  # @default -- `""`
  # **REQUIRED**: Blob storage backend type
  # Options: aws_s3, azure_blob
  integrityAppBlobStoreType: ""

  # -- AWS S3 Region
  # @default -- `""`
  # **REQUIRED for S3**: AWS region (e.g., "us-east-1")
  # Only used when integrityAppBlobStoreType is "aws_s3"
  integrityAppBlobStoreRegion: ""

  # -- AWS S3 Bucket
  # @default -- `""`
  # **REQUIRED for S3**: Bucket name
  # Only used when integrityAppBlobStoreType is "aws_s3"
  integrityAppBlobStoreBucket: ""

  # -- AWS S3 Folder
  # @default -- `""`
  # Optional S3 folder/prefix
  # Only used when integrityAppBlobStoreType is "aws_s3"
  integrityAppBlobStoreFolder: ""

  # -- AWS Access Key ID
  # @default -- `""` (auto-configured from secrets.storage.aws_s3)
  # Only used when integrityAppBlobStoreType is "aws_s3"
  integrityAppBlobStoreAccessKeyId: ""

  # -- AWS Secret Access Key
  # @default -- `""` (auto-configured from secrets.storage.aws_s3)
  # Only used when integrityAppBlobStoreType is "aws_s3"
  integrityAppBlobStoreSecretAccessKey: ""

  # -- Azure Storage Account
  # @default -- `""` (auto-configured from secrets.storage.azure_blob)
  # Only used when integrityAppBlobStoreType is "azure_blob"
  integrityAppBlobStoreAccount: ""

  # -- Azure Container Name
  # @default -- `""`
  # **REQUIRED for Azure**: Container name
  # Only used when integrityAppBlobStoreType is "azure_blob"
  integrityAppBlobStoreContainer: ""

  # -- Azure Storage Account Key
  # @default -- `""` (auto-configured from secrets.storage.azure_blob)
  # Only used when integrityAppBlobStoreType is "azure_blob"
  integrityAppBlobStoreKey: ""

  # ---------------------------------------------------------------------------
  # Logging Configuration
  # ---------------------------------------------------------------------------

  # -- Default Log Level
  # @default -- `warn`
  # Options: trace, debug, info, warn, error
  integrityAppLoggingLogLevelDefault: "warn"

  # -- Service Log Level
  # @default -- `trace`
  # Integrity service specific log level
  # Options: trace, debug, info, warn, error
  integrityAppLoggingLogLevelIntegrityService: "trace"

  # ---------------------------------------------------------------------------
  # Authentication Configuration
  # ---------------------------------------------------------------------------

  # -- Auth Type
  # @default -- `auth_service`
  integrityAppAuthType: "auth_service"

  # -- Auth Service URL
  # @default -- `""` (auto-generated: "http://{Release.Name}-auth-service:8080")
  integrityAppAuthUrl: ""

  # ---------------------------------------------------------------------------
  # Service URL Configuration
  # ---------------------------------------------------------------------------

  # -- Integrity Service URL
  # @default -- `""` (auto-generated from global.domain)
  # Public URL for this service
  integrityServiceUrl: ""

# =============================================================================
# SECRETS CONFIGURATION
# =============================================================================
secrets:
  # -- Database Secret
  # @default -- See values below
  database:
    # -- Secret Name
    # @default -- `""` (auto-configured from global.secrets.database.secretName)
    name: ""

  # -- Storage Secrets
  # @default -- See values below
  # Only configure the section matching your storage provider
  storage:
    # -- Azure Blob Storage Secret
    # @default -- See values below
    # Only used when integrityAppBlobStoreType is "azure_blob"
    azure_blob:
      # -- Secret Name
      # @default -- `""` (auto-configured from global.secrets.storage.azure_blob.secretName)
      name: ""

    # -- AWS S3 Secret
    # @default -- See values below
    # Only used when integrityAppBlobStoreType is "aws_s3"
    aws_s3:
      # -- Secret Name
      # @default -- `""` (auto-configured from global.secrets.storage.aws_s3.secretName)
      name: ""
