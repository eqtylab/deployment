# Simplified Keycloak Bootstrap values for staging environment
# This configures the bootstrap job without SPI mappers or group management
# Groups/projects are now managed in the governance service

# Bootstrap job configuration
bootstrap:
  enabled: true

  # Use an image that already has curl and jq
  image:
    repository: dwdraju/alpine-curl-jq
    tag: "latest"
    pullPolicy: IfNotPresent

  # Job settings
  backoffLimit: 3
  ttlSecondsAfterFinished: 300
  activeDeadlineSeconds: 600

  # Disable the built-in wait since it checks the wrong port
  wait:
    enabled: false

  # Resources
  resources:
    limits:
      cpu: 500m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

# Keycloak connection
keycloak:
  # Internal service URL
  url: "http://keycloak:8080/keycloak"
  adminUsername: "admin"
  adminPasswordSecret:
    name: "keycloak-admin"
    key: "password"

  # Realm configuration
  realm:
    name: "governance"
    displayName: "Governance Platform"
    loginWithEmailAllowed: true
    registrationAllowed: false
    resetPasswordAllowed: true
    rememberMe: true
    verifyEmail: false
    sslRequired: "external"
    bruteForceProtected: true

  # Token configuration
  tokens:
    accessTokenLifespan: 300 # 5 minutes
    ssoSessionIdleTimeout: 1800 # 30 minutes
    ssoSessionMaxLifespan: 36000 # 10 hours

# Client configuration
clients:
  # Frontend client (public)
  frontend:
    clientId: "governance-platform-frontend"
    name: "Governance Platform Frontend"
    description: "Frontend application for Governance Platform"
    publicClient: true
    redirectUris:
      - "https://CHANGE_ME_DOMAIN_HERE/*"
      - "http://localhost:5173/*"
    webOrigins:
      - "https://CHANGE_ME_DOMAIN_HERE"
      - "http://localhost:5173"
    defaultScopes:
      - "openid"
      - "profile"
      - "email"
      - "roles"
    optionalScopes:
      - "offline_access"

  # Backend client (confidential with service account)
  backend:
    clientId: "governance-platform-backend"
    name: "Governance Platform Backend"
    description: "Backend service for Governance Platform"
    publicClient: false
    serviceAccountsEnabled: true
    secretName: "keycloak-backend-client"
    secretKey: "client-secret"
    redirectUris:
      - "https://CHANGE_ME_DOMAIN_HERE/auth/*"
    webOrigins:
      - "https://CHANGE_ME_DOMAIN_HERE"
    defaultScopes:
      - "openid"
      - "profile"
      - "email"
      - "roles"

  # Worker client (service account only)
  worker:
    clientId: "governance-worker"
    name: "Governance Worker"
    description: "Worker service for Governance Platform"
    publicClient: false
    serviceAccountsEnabled: true
    secretName: "keycloak-worker-client"
    secretKey: "client-secret"
    defaultScopes:
      - "openid"
      - "profile"
      - "email"
      - "roles"

# Custom scopes for authorization
scopes:
  - name: "governance:declarations:create"
    description: "Create governance declarations"
  - name: "integrity:statements:create"
    description: "Create integrity statements"
  - name: "read:organizations"
    description: "Read access to organizations"
  - name: "write:organizations"
    description: "Write access to organizations"
  - name: "read:projects"
    description: "Read access to projects"
  - name: "write:projects"
    description: "Write access to projects"
  - name: "read:evaluations"
    description: "Read access to evaluations"
  - name: "write:evaluations"
    description: "Write access to evaluations"

# Initial users
users:
  # Platform admin user
  admin:
    enabled: true
    username: "platform-admin"
    email: "admin@governance.eqtylab.io"
    firstName: "Platform"
    lastName: "Admin"
    emailVerified: true
    temporaryPassword: false
    secretName: "keycloak-admin-user"
    secretKey: "password"

  # Test users - disabled by default
  testUsers:
    enabled: false
    users: []

# Output configuration
output:
  generateEnvFile: true
  createSecrets: true
  secrets:
    frontend: "keycloak-frontend-config"
    backend: "keycloak-backend-config"
    worker: "keycloak-worker-config"
