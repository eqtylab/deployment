{{- if .Values.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "governance-studio.fullname" . }}-config
  labels:
    {{- include "governance-studio.labels" . | nindent 4 }}
data:
  # API Configuration
  API_URL: {{ .Values.config.apiUrl | default (printf "https://%s/governanceService" (((.Values.global).domain) | default "")) | quote }}
  AUTH_SERVICE_URL: {{ .Values.config.authServiceUrl | default (printf "https://%s/authService" (((.Values.global).domain) | default "")) | quote }}
  {{- if .Values.config.features.lineage }}
  INTEGRITY_SERVICE_URL: {{ .Values.config.integrityServiceUrl | default (printf "https://%s/integrityService" (((.Values.global).domain) | default "")) | quote }}
  {{- end }}
  {{- if .Values.config.features.guardianGarage }}
  GARAGE_SERVICE_URL: {{ .Values.config.garageServiceUrl | default (printf "https://%s/garage" (((.Values.global).domain) | default "")) | quote }}
  {{- end }}

  # Application Settings
  ENVIRONMENT: {{ .Values.config.environment | default ((.Values.global).environmentType | default "") | quote }}
  APP_TITLE: {{ .Values.config.appTitle | quote }}
  BASE_PATH: {{ .Values.config.basePath | quote }}

  # Feature Flags
  FEATURE_GOVERNANCE: {{ .Values.config.features.governance | quote }}
  FEATURE_LINEAGE: {{ .Values.config.features.lineage | quote }}
  FEATURE_GUARDIAN_ENABLED: {{ .Values.config.features.guardianEnabled | quote }}
  FEATURE_GUARDIAN_GARAGE: {{ .Values.config.features.guardianGarage | quote }}
  FEATURE_GUARDIAN_RULEBOOKS: {{ .Values.config.features.guardianRulebooks | quote }}
  FEATURE_GUARDIAN_OS_FUNCTIONS: {{ .Values.config.features.guardianOsFunctions | quote }}
  FEATURE_GUARDIAN_SDK_FUNCTIONS: {{ .Values.config.features.guardianSdkFunctions | quote }}
  FEATURE_GUARDIAN_AGENT_MANAGEMENT: {{ .Values.config.features.agentManagement | quote }}

  # Auth Configuration
  AUTH_PROVIDER: {{ .Values.config.authProvider | default (((.Values.global).secrets).auth).provider | default "" | quote }}

  # Auth0 Settings (only included when Auth0 is the provider)
  {{- if eq (.Values.config.authProvider | default (((.Values.global).secrets).auth).provider | default "") "auth0" }}
  AUTH0_DOMAIN: {{ .Values.config.auth0Domain | quote }}
  AUTH0_CLIENT_ID: {{ .Values.config.auth0ClientId | quote }}
  AUTH0_AUDIENCE: {{ .Values.config.auth0Audience | quote }}
  {{- end }}

  # Keycloak Settings (only included when Keycloak is the provider)
  {{- if eq (.Values.config.authProvider | default (((.Values.global).secrets).auth).provider | default "") "keycloak" }}
  KEYCLOAK_URL: {{ .Values.config.keycloakUrl | default "" | quote }}
  KEYCLOAK_CLIENT_ID: {{ .Values.config.keycloakClientId | default "" | quote }}
  KEYCLOAK_REALM: {{ .Values.config.keycloakRealm | default "" | quote }}
  {{- end }}
{{- end }}
