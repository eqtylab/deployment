# Development/Local Configuration
# Minimal configuration for local development and testing
#
# Usage:
#   helm install auth-service ./charts/auth-service -f examples/values-development.yaml
#
# Prerequisites:
#   - Local PostgreSQL (or use the postgresql subchart from governance-platform)
#   - Auth0 tenant with development application
#
# This example demonstrates:
#   - Minimal required configuration for development
#   - Debug-level logging
#   - Swagger UI enabled for API exploration
#   - Relaxed security settings for local testing
#   - Single replica (no HA)

# =============================================================================
# APPLICATION CONFIGURATION
# =============================================================================

config:
  server:
    environment: "development"
    # Enable Swagger UI for API exploration during development
    swaggerEnabled: true

  logging:
    # Debug logging for development troubleshooting
    level: "debug"
    # Text format is easier to read in local terminals
    format: "text"

  # CORS enabled for local frontend development (different ports)
  cors:
    enabled: true
    origins: "http://localhost:3000,http://localhost:5173,http://127.0.0.1:3000"

  # Identity Provider configuration
  idp:
    provider: "auth0"
    # For development, you may need to skip issuer verification if using localhost
    skipIssuerVerification: false

    auth0:
      # Replace with your Auth0 development tenant
      domain: "dev-your-tenant.auth0.com"
      enableManagementAPI: true
      managementAudience: "https://dev-your-tenant.auth0.com/api/v2/"
      apiIdentifier: "http://localhost:8080"
      defaultConnection: "Username-Password-Authentication"
      defaultRoles: ["user"]
      sendInvitationEmail: false # Disable emails in development
      syncAtStartup: false
      syncPageSize: 100

  # For development, you can use "local" key vault (file-based)
  keyVault:
    provider: "local"
    cacheTTLMinutes: 5

  # Service integration URLs (assuming local docker-compose or k8s)
  integrations:
    integrityServiceUrl: "http://integrity-service:3050"
    governanceServiceUrl: "http://governance-service:10001"

  # Service accounts can be disabled for simpler development
  serviceAccounts:
    autoCreate: false
    governanceWorker:
      enabled: false

  # Disable rate limiting for development
  rateLimit:
    enabled: false

  # RBAC cache with shorter TTL for faster development iteration
  rbac:
    cache:
      enabled: true
      ttl: "30s"
      maxSize: 100

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

externalDatabase:
  # Local PostgreSQL or docker-compose service
  host: "localhost"
  port: 5432
  name: "governance_dev"
  user: "postgres"
  # Plain password for development (use secrets in production!)
  password: "postgres"
  sslMode: "disable"
  maxOpenConns: 10
  maxIdleConns: 2
  connMaxLifetime: "5m"

migrations:
  runAtStartup: true
  path: "/internal/database/migrations"

# =============================================================================
# SECRET CONFIGURATION
# =============================================================================

# For development, you can use inline values or simple secrets
secrets:
  auth:
    name: "auth-service-dev-auth"
    keys:
      clientId: "client-id"
      clientSecret: "client-secret"
      managementClientId: "client-id"
      managementClientSecret: "client-secret"

  security:
    name: "auth-service-dev-security"
    keys:
      apiSecret: "api-secret"
      jwtSecret: "jwt-secret"

  session:
    name: "auth-service-dev-security"
    keys:
      secret: "session-secret"

# =============================================================================
# DEPLOYMENT CONFIGURATION
# =============================================================================

# Single replica for development
replicaCount: 1

image:
  repository: ghcr.io/eqtylab/auth-service
  pullPolicy: IfNotPresent
  # Use specific version for reproducibility, or "latest" for development
  tag: ""

# No autoscaling needed for development
autoscaling:
  enabled: false

# Minimal resources for local development
resources:
  requests:
    cpu: 50m
    memory: 64Mi
  limits:
    cpu: 500m
    memory: 256Mi

# =============================================================================
# SERVICE CONFIGURATION
# =============================================================================

service:
  enabled: true
  type: ClusterIP
  port: 8080

# No ingress for local development - use port-forward
ingress:
  enabled: false

# =============================================================================
# OBSERVABILITY
# =============================================================================

metrics:
  enabled: true
  port: 9090
  path: "/metrics"
  serviceMonitor:
    enabled: false

# =============================================================================
# SECURITY (RELAXED FOR DEVELOPMENT)
# =============================================================================

# Relaxed security context for development
podSecurityContext:
  runAsNonRoot: false

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: false
  runAsNonRoot: false

# No PDB for development
podDisruptionBudget:
  enabled: false

# No network policies for development
networkPolicy:
  enabled: false

# No affinity rules for development
affinity: {}
nodeSelector: {}
tolerations: []
