# =============================================================================
# AUTH SERVICE - HELM VALUES CONFIGURATION
# =============================================================================
# This values file configures the Auth Service for identity provider
# integration and authentication management.
#
# When deployed via the umbrella chart (governance-platform), most values
# are auto-configured from global settings.
# =============================================================================

# -- Enable Service
# @default -- `true`
# Enable the Auth Service
enabled: true

# -- Replica Count
# @default -- `2`
# Number of pod replicas to run (ignored if autoscaling.enabled is true)
replicaCount: 2

# -- Image Configuration
# @default -- See values below
# Container image settings for Auth Service
image:
  # -- Image Repository
  # @default -- `ghcr.io/eqtylab/auth-service`
  repository: ghcr.io/eqtylab/auth-service
  # -- Image Pull Policy
  # @default -- `IfNotPresent`
  # Options: IfNotPresent, Always, Never
  pullPolicy: IfNotPresent
  # -- Image Tag
  # @default -- `""` (uses chart appVersion)
  tag: ""

# -- Image Pull Secrets
# @default -- `[]` (auto-configured from global.secrets.imageRegistry.secretName)
# Additional secrets for pulling images from private registries
imagePullSecrets: []

# -- Name Override
# @default -- `""`
# Override the chart name used for resource naming
nameOverride: ""

# -- Full Name Override
# @default -- `""`
# Override the full name used for resource naming
fullnameOverride: ""

# -- Service Account Configuration
# @default -- See values below
serviceAccount:
  # -- Create Service Account
  # @default -- `true`
  create: true
  # -- Automount API Credentials
  # @default -- `true`
  automount: true
  # -- Service Account Annotations
  # @default -- `{}`
  annotations: {}
  # -- Service Account Name
  # @default -- `""` (generated if create is true)
  name: ""

# -- Pod Annotations
# @default -- `{}`
# Additional annotations to add to pods
podAnnotations: {}

# -- Pod Labels
# @default -- `{}`
# Additional labels to add to pods
podLabels: {}

# -- Pod Security Context
# @default -- See values below
# Security context applied at the pod level
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

# -- Container Security Context
# @default -- See values below
# Security context applied at the container level
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true
  runAsNonRoot: true
  runAsUser: 1000

# -- Service Configuration
# @default -- See values below
service:
  # -- Enable Service
  # @default -- `true`
  enabled: true
  # -- Service Type
  # @default -- `ClusterIP`
  # Options: ClusterIP, NodePort, LoadBalancer
  type: ClusterIP
  # -- Service Port
  # @default -- `8080`
  port: 8080

# -- Ingress Configuration
# @default -- See values below
ingress:
  # -- Enable Ingress
  # @default -- `false`
  enabled: false
  # -- Ingress Class Name
  # @default -- `""`
  # Example: "nginx", "traefik"
  className: ""
  # -- Ingress Annotations
  # @default -- `{}`
  annotations: {}
    # cert-manager.io/issuer: "letsencrypt-prod"
    # nginx.ingress.kubernetes.io/rewrite-target: /$2
    # nginx.ingress.kubernetes.io/proxy-body-size: "64m"
  # -- Ingress Hosts
  # @default -- See values below
  hosts:
    - host: auth.example.com
      paths:
        - path: "/authService(/|$)(.*)"
          pathType: ImplementationSpecific
  # -- TLS Configuration
  # @default -- `[]`
  tls: []
    # - secretName: auth-service-tls
    #   hosts:
    #     - auth.example.com

# -- Resource Configuration
# @default -- See values below
# CPU and memory resource requests and limits
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 128Mi

# -- Autoscaling Configuration
# @default -- See values below
autoscaling:
  # -- Enable Autoscaling
  # @default -- `false`
  enabled: false
  # -- Minimum Replicas
  # @default -- `2`
  minReplicas: 2
  # -- Maximum Replicas
  # @default -- `10`
  maxReplicas: 10
  # -- Target CPU Utilization
  # @default -- `80`
  targetCPUUtilizationPercentage: 80
  # -- Target Memory Utilization
  # @default -- `80`
  targetMemoryUtilizationPercentage: 80

# -- Pod Disruption Budget
# @default -- See values below
podDisruptionBudget:
  # -- Enable PDB
  # @default -- `true`
  enabled: true
  # -- Minimum Available
  # @default -- `1`
  # Note: typically only applied when autoscaling is enabled or replicaCount > 1
  minAvailable: 1

# -- Node Selector
# @default -- `{}`
# Node labels for pod assignment
nodeSelector: {}

# -- Tolerations
# @default -- `[]`
# Tolerations for pod assignment
tolerations: []

# -- Affinity
# @default -- See values below
# Affinity rules for pod assignment
affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - auth-service
          topologyKey: kubernetes.io/hostname

# -- Init Containers
# @default -- `[]`
# Init containers to add to the pod
initContainers: []

# -- Startup Probe
# @default -- See values below
startupProbe:
  httpGet:
    path: /health
    port: http
  failureThreshold: 30
  periodSeconds: 10

# -- Liveness Probe
# @default -- See values below
livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3
  successThreshold: 1

# -- Readiness Probe
# @default -- See values below
readinessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3
  successThreshold: 1

# -- Volumes
# @default -- `[]`
# Additional volumes on the Deployment
volumes: []

# -- Volume Mounts
# @default -- `[]`
# Additional volumeMounts on the Deployment
volumeMounts: []

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

# -- External Database Configuration
# @default -- See values below
externalDatabase:
  # -- Database Host
  # @default -- `""` (auto-generated: "{Release.Name}-postgresql")
  host: ""
  # -- Database Port
  # @default -- `""` (defaults to 5432)
  port: ""
  # -- Database Name
  # @default -- `""` (defaults to "governance")
  name: ""
  # -- Database User
  # @default -- `""` (defaults to "postgres")
  user: ""
  # -- Database Password
  # @default -- `""` (auto-configured from global.secrets.database)
  password: ""
  # -- SSL Mode
  # @default -- `disable`
  # Options: disable, require, verify-ca, verify-full
  sslMode: "disable"

  # -- Password Secret Reference
  # @default -- See values below
  passwordSecretKeyRef:
    # -- Secret Name
    # @default -- `""` (auto-configured from global.secrets.database.secretName)
    name: ""
    # -- Secret Key
    # @default -- `""` (defaults to "password")
    key: ""

# -- Database Migrations
# @default -- See values below
migrations:
  # -- Run at Startup
  # @default -- `true`
  # Run database migrations automatically at startup
  runAtStartup: true
  # -- Migration Path
  # @default -- `/internal/database/migrations`
  # Path to migration files within the container
  path: "/internal/database/migrations"

# =============================================================================
# SECRETS CONFIGURATION
# =============================================================================

# -- Secrets Configuration
# @default -- See values below
secrets:
  # -- Auth Provider Secrets
  # @default -- See values below
  # Only configure the section matching your auth provider
  auth:
    # -- Auth0 Secret
    # @default -- See values below
    # Only used when provider is "auth0"
    auth0:
      # -- Secret Name
      # @default -- `""` (auto-configured from global.secrets.auth.auth0.secretName)
      name: ""
    # -- Keycloak Secret
    # @default -- See values below
    # Only used when provider is "keycloak"
    keycloak:
      # -- Secret Name
      # @default -- `""` (auto-configured from global.secrets.auth.keycloak.secretName)
      name: ""

  # -- Auth Service Secrets
  # @default -- See values below
  authService:
    # -- Secret Name
    # @default -- `""` (auto-configured from global.secrets.authService.secretName)
    name: ""

  # -- Secret Manager Credentials
  # @default -- See values below
  # For DID key signing
  secretManager:
    # -- Azure Key Vault Secret
    # @default -- See values below
    # Only used when provider is "azure_key_vault"
    azure_key_vault:
      # -- Secret Name
      # @default -- `""` (auto-configured from global.secrets.secretManager.azure_key_vault.secretName)
      name: ""

  # -- Governance Worker Secret
  # @default -- See values below
  governanceWorker:
    # -- Secret Name
    # @default -- `""` (auto-configured from global.secrets.governanceWorker.secretName)
    name: ""

# =============================================================================
# APPLICATION CONFIGURATION
# =============================================================================

# -- Application Configuration
# @default -- See values below
config:
  # ---------------------------------------------------------------------------
  # Server Configuration
  # ---------------------------------------------------------------------------

  # -- Server Configuration
  # @default -- See values below
  server:
    # -- Port
    # @default -- `8080`
    port: 8080
    # -- Host
    # @default -- `0.0.0.0`
    host: "0.0.0.0"
    # -- Environment
    # @default -- `""` (auto-configured from global.environmentType, defaults to "development")
    environment: ""
    # -- Swagger Enabled
    # @default -- `true`
    # Enable Swagger documentation
    swaggerEnabled: true
    # -- Swagger Host
    # @default -- `""` (auto-generated from global.domain)
    # Only used when swaggerEnabled is true
    swaggerHost: ""
    # -- Swagger Base Path
    # @default -- `/authService`
    # Only used when swaggerEnabled is true
    swaggerBasePath: "/authService"

  # ---------------------------------------------------------------------------
  # Auth Service Secrets (API and JWT)
  # ---------------------------------------------------------------------------

  # -- API Secret
  # @default -- `""` (auto-configured from global.secrets.authService)
  apiSecret: ""

  # -- JWT Secret
  # @default -- `""` (auto-configured from global.secrets.authService)
  jwtSecret: ""

  # ---------------------------------------------------------------------------
  # Logging Configuration
  # ---------------------------------------------------------------------------

  # -- Logging Configuration
  # @default -- See values below
  logging:
    # -- Log Level
    # @default -- `info`
    # Options: debug, info, warn, error
    level: "info"
    # -- Log Format
    # @default -- `json`
    # Options: json, text
    format: "json"
    # -- Skip Paths
    # @default -- `/health,/health/live,/health/ready,/metrics`
    # Paths to skip in access logs
    skipPaths: "/health,/health/live,/health/ready,/metrics"

  # ---------------------------------------------------------------------------
  # CORS Configuration
  # ---------------------------------------------------------------------------

  # -- CORS Configuration
  # @default -- See values below
  cors:
    # -- Enable CORS
    # @default -- `false`
    # Usually handled by ingress in Kubernetes
    enabled: false
    # -- Allowed Origins
    # @default -- `*`
    origins: "*"

  # ---------------------------------------------------------------------------
  # Identity Provider Configuration
  # ---------------------------------------------------------------------------

  # -- Identity Provider Configuration
  # @default -- See values below
  idp:
    # -- Provider
    # @default -- `""` (auto-configured from global.secrets.auth.provider, defaults to "auth0")
    # Options: auth0, keycloak
    provider: ""
    # -- OIDC Issuer URL
    # @default -- `""`
    issuer: ""
    # -- Skip Issuer Verification
    # @default -- `false`
    # Dangerous - only for development
    skipIssuerVerification: false

    # -- Auth0 Configuration
    # @default -- See values below
    # Only used when provider is "auth0"
    auth0:
      # -- Domain
      # @default -- `""`
      # **REQUIRED for Auth0**: Tenant domain (e.g., "yourcompany.us.auth0.com")
      domain: ""
      # -- Management Audience
      # @default -- `""`
      # **REQUIRED for Auth0**: Management API audience (e.g., "https://yourcompany.us.auth0.com/api/v2/")
      managementAudience: ""
      # -- API Identifier
      # @default -- `""`
      # **REQUIRED for Auth0**: API identifier (e.g., "https://governance.yourcompany.com")
      apiIdentifier: ""
      # -- Default Connection
      # @default -- `Username-Password-Authentication`
      # Default connection for user creation
      defaultConnection: "Username-Password-Authentication"
      # -- Default Roles
      # @default -- `[user]`
      # Default roles for new users
      defaultRoles:
        - user
      # -- Send Invitation Email
      # @default -- `true`
      # Send invitation email on user creation
      sendInvitationEmail: true
      # -- Client ID
      # @default -- `""` (auto-configured from global.secrets.auth.auth0)
      # Only used when provider is "auth0"
      clientId: ""
      # -- Client Secret
      # @default -- `""` (auto-configured from global.secrets.auth.auth0)
      # Only used when provider is "auth0"
      clientSecret: ""
      # -- Management Client ID
      # @default -- `""` (auto-configured from global.secrets.auth.auth0)
      # Only used when provider is "auth0"
      managementClientId: ""
      # -- Management Client Secret
      # @default -- `""` (auto-configured from global.secrets.auth.auth0)
      # Only used when provider is "auth0"
      managementClientSecret: ""

    # -- Keycloak Configuration
    # @default -- See values below
    # Only used when provider is "keycloak"
    keycloak:
      # -- Realm
      # @default -- `""`
      # **REQUIRED for Keycloak**: Realm name (e.g., "governance")
      realm: ""
      # -- Admin URL
      # @default -- `""`
      # **REQUIRED for Keycloak**: Admin URL for admin operations (e.g., "https://keycloak.example.com")
      adminUrl: ""
      # -- Enable User Management
      # @default -- `false`
      # Enable user management via Keycloak admin API
      enableUserManagement: false
      # -- Enable Group Sync
      # @default -- `false`
      # Enable group sync with Keycloak
      enableGroupSync: false
      # -- Client ID
      # @default -- `""`
      # **REQUIRED for Keycloak**: SPA client ID (public, e.g., "governance-platform-frontend")
      clientId: ""
      # -- Service Account Client ID
      # @default -- `""` (auto-configured from global.secrets.auth.keycloak)
      # Only used when provider is "keycloak"
      serviceAccountClientId: ""
      # -- Service Account Client Secret
      # @default -- `""` (auto-configured from global.secrets.auth.keycloak)
      # Only used when provider is "keycloak"
      serviceAccountClientSecret: ""

  # ---------------------------------------------------------------------------
  # Key Vault Configuration
  # ---------------------------------------------------------------------------

  # -- Key Vault Configuration
  # @default -- See values below
  keyVault:
    # -- Provider
    # @default -- `""` (auto-configured from global.secrets.secretManager.provider)
    # Options: azure_key_vault, local
    provider: ""
    # -- Cache TTL Minutes
    # @default -- `15`
    # DID Key cache TTL in minutes
    cacheTTLMinutes: 15

    # -- Azure Key Vault Configuration
    # @default -- See values below
    # Only used when provider is "azure_key_vault"
    azure:
      # -- Vault URL
      # @default -- `""` (auto-configured from global.secrets.secretManager.azure_key_vault.values.vaultUrl)
      vaultUrl: ""
      # -- Tenant ID
      # @default -- `""` (auto-configured from global.secrets.secretManager.azure_key_vault.values.tenantId)
      tenantId: ""
      # -- Client ID
      # @default -- `""` (auto-configured from global.secrets.secretManager.azure_key_vault)
      # Only used when provider is "azure_key_vault"
      clientId: ""
      # -- Client Secret
      # @default -- `""` (auto-configured from global.secrets.secretManager.azure_key_vault)
      # Only used when provider is "azure_key_vault"
      clientSecret: ""

  # ---------------------------------------------------------------------------
  # Service Accounts Configuration
  # ---------------------------------------------------------------------------

  # -- Service Accounts Configuration
  # @default -- See values below
  serviceAccounts:
    # -- Governance Worker Configuration
    # @default -- See values below
    governanceWorker:
      # -- Enabled
      # @default -- `true`
      # Enable governance worker service account
      enabled: true
      # -- Scopes
      # @default -- See values below
      # Scopes for service account
      scopes:
        - "governance:declarations:create"
        - "integrity:statements:create"
      # -- Audience
      # @default -- `""`
      # **REQUIRED for Auth0**: API audience for worker (e.g., "https://governance.yourcompany.com")
      audience: ""
      # -- Client ID
      # @default -- `""` (auto-configured from global.secrets.governanceWorker)
      clientId: ""
      # -- Client Secret
      # @default -- `""` (auto-configured from global.secrets.governanceWorker)
      clientSecret: ""
      # -- Encryption Key
      # @default -- `""` (auto-configured from global.secrets.governanceWorker)
      encryptionKey: ""

  # ---------------------------------------------------------------------------
  # Token Exchange Configuration
  # ---------------------------------------------------------------------------

  # -- Token Exchange Configuration
  # @default -- See values below
  # For Keycloak integration
  tokenExchange:
    # -- Enabled
    # @default -- `false`
    # Enable token exchange
    enabled: false
    # -- Key ID
    # @default -- `auth-service-prod-001`
    # Key identifier for signing key
    keyId: "auth-service-prod-001"
    # -- Private Key
    # @default -- `""` (auto-configured from global.secrets.auth.keycloak)
    # Only used when tokenExchange is enabled
    privateKey: ""

# =============================================================================
# METRICS CONFIGURATION
# =============================================================================

# -- Metrics Configuration
# @default -- See values below
metrics:
  # -- Enabled
  # @default -- `false`
  # Enable Prometheus metrics
  enabled: false
  # -- Port
  # @default -- `9090`
  port: 9090
  # -- Path
  # @default -- `/metrics`
  path: "/metrics"

  # -- Service Monitor
  # @default -- See values below
  serviceMonitor:
    # -- Enabled
    # @default -- `false`
    # Enable ServiceMonitor for Prometheus Operator
    enabled: false
    # -- Interval
    # @default -- `30s`
    # Scrape interval
    interval: "30s"
    # -- Scrape Timeout
    # @default -- `10s`
    scrapeTimeout: "10s"
    # -- Labels
    # @default -- `{}`
    # Additional labels for ServiceMonitor
    labels: {}

# =============================================================================
# NETWORK POLICY CONFIGURATION
# =============================================================================

# -- Network Policy Configuration
# @default -- See values below
networkPolicy:
  # -- Enabled
  # @default -- `false`
  # Enable NetworkPolicy
  enabled: false

  # -- Ingress Rules
  # @default -- See values below
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: ingress-nginx
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: governance-service
      ports:
        - protocol: TCP
          port: 8080

  # -- Egress Rules
  # @default -- See values below
  egress:
    # Allow DNS
    - to:
        - namespaceSelector:
            matchLabels:
              name: kube-system
      ports:
        - protocol: TCP
          port: 53
        - protocol: UDP
          port: 53

    # Allow PostgreSQL
    - to:
        - podSelector:
            matchLabels:
              app.kubernetes.io/name: postgresql
      ports:
        - protocol: TCP
          port: 5432

    # Allow external HTTPS (for IDP communication)
    - to: []
      ports:
        - protocol: TCP
          port: 443

# =============================================================================
# MIGRATION JOB CONFIGURATION
# =============================================================================

# -- Migration Job Configuration
# @default -- See values below
migration:
  # -- Enabled
  # @default -- `false`
  # Enable migration as a Helm hook job
  enabled: false
  # -- Backoff Limit
  # @default -- `3`
  # Job backoff limit
  backoffLimit: 3
  # -- Active Deadline Seconds
  # @default -- `300`
  # Job active deadline in seconds
  activeDeadlineSeconds: 300
  # -- TTL Seconds After Finished
  # @default -- `300`
  # TTL for completed jobs
  ttlSecondsAfterFinished: 300

  # -- Resources
  # @default -- See values below
  resources:
    limits:
      cpu: 200m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

# =============================================================================
# EXTRA CONFIGURATION
# =============================================================================

# -- Extra Environment Variables
# @default -- `[]`
extraEnvVars: []
  # - name: EXTRA_VAR
  #   value: "extra-value"

# -- Extra Environment Variables Secret
# @default -- `""`
# Extra environment variables from Secret
extraEnvVarsSecret: ""

# -- Extra Environment Variables ConfigMap
# @default -- `""`
# Extra environment variables from ConfigMap
extraEnvVarsConfigMap: ""

# -- Extra Containers
# @default -- `[]`
# Extra containers to add to the pod
extraContainers: []

# -- Extra Manifests
# @default -- `[]`
# Extra manifests to deploy
extraManifests: []
